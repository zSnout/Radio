class Radio{static queryData(t){for(var n=Object.keys(t),e=[],o=0;o<n.length;o++)e.push(encodeURIComponent(n[o])+"="+encodeURIComponent(t[n[o]]));return e.join("&")}static fetch(t,n){return t?(n=n||{},new Promise(function(e,o){fetch(t+"?"+Radio.queryData(n)).then(function(t){200!==t.status?t.text().then(function(t){o(t)}):t.text().then(function(t){e(t)})})})):Promise.reject("")}fetch(t,n){return t?((n=n||{}).domain=this.domain,n.stream=this.stream,n.password=this.password,Radio.fetch(t,n)):Promise.reject("")}constructor(t,n){t=t||"",n=n||"",this.domain=window.location.host,this.stream=t,this.password=n,this.gotten=0,this.connect()}connect(){var t=this;return new Promise(function(n,e){t.fetch("https://zsnout.com/radio/connect").then(function(t){n("SUCCESS"==t)},function(t){e(t)})})}sendMessage(t){var n=this;return new Promise(function(e,o){n.fetch("https://zsnout.com/radio/send",{message:t}).then(function(t){e("SUCCESS"==t)},function(t){o(t)})})}getAllData(){var t=this;return new Promise(function(n,e){t.fetch("https://zsnout.com/radio/data").then(function(e){e=JSON.parse(e),t.gotten=e.length,n(e)},function(t){e(t)})})}getNewData(){var t=this;return new Promise(function(n,e){t.fetch("https://zsnout.com/radio/data").then(function(e){var o=JSON.parse(e);t.gotten!=o.length?(e=o.slice(t.gotten),t.gotten=o.length,n(e)):n([])},function(t){e(t)})})}waitForNew(t){var n=this;return t=Number(t)||5e3,isNaN(t)?Promise.reject(""):(t=Math.max(t,5e3),new Promise(function(e,o){!function i(){window.setTimeout(function(){n.getNewData().then(function(t){if(!(t.length>=1))return i();e(t)},function(t){o(t)})},t)}()}))}onNewData(t,n){if(n=Number(n)||5e3,isNaN(n))return Promise.reject("");n=Math.max(n,5e3)}}
